!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).YuyanMonitor=e()}(this,(function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(){n=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=Object.create((e&&e.prototype instanceof p?e:p).prototype),a=new P(r||[]);return o(i,"_invoke",{value:S(t,n,a)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function p(){}function h(){}function v(){}var g={};u(g,a,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(I([])));m&&m!==e&&r.call(m,a)&&(g=m);var b=v.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return _()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=C(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=f(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function C(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,C(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=f(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,d;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function I(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:_}}function _(){return{value:void 0,done:!0}}return h.prototype=v,o(b,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:h,configurable:!0}),h.displayName=u(v,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(E.prototype),u(E.prototype,c,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,s,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(this.prev>=i.tryLoc){var c=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(c&&s){if(i.catchLoc>this.prev)return n(i.catchLoc,!0);if(i.finallyLoc>this.prev)return n(i.finallyLoc)}else if(c){if(i.catchLoc>this.prev)return n(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(i.finallyLoc>this.prev)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(this.prev>=o.tryLoc&&r.call(o,"finallyLoc")&&o.finallyLoc>this.prev){var i=o;break}}i&&("break"===t||"continue"===t)&&e>=i.tryLoc&&i.finallyLoc>=e&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e,n,r,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function c(t){o(a,r,i,c,s,"next",t)}function s(t){o(a,r,i,c,s,"throw",t)}c(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function s(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,n){return(e=h(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}(this,n)}}function h(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function g(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(t,e)||b(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){if(t){if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}var E=function(t){return function(){if(!t||!t.navigator||!t.navigator.userAgent)return"";var e=t.navigator.userAgent,n="";return!!e.match(/iphone|ipad|iPod/gi)&&(n="iOS"),!!e.match(/android/gi)&&(n="Android"),!!e.match(/Firefox/gi)&&(n="Firefox"),!!e.match(/Chrome/gi)&&(n="Chrome"),!e.match(/Chrome/gi)&&!!e.match(/Safari/gi)&&(n="Safari"),!!e.match(/Opera/gi)&&(n="Opera"),!!e.match(/MSIE/gi)&&(n="IE"),n}}(void 0);function S(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function C(t,e,n,r,o,i){return S((a=S(S(e,t),S(r,i)))<<(c=o)|a>>>32-c,n);var a,c}function A(t,e,n,r,o,i,a){return C(e&n|~e&r,t,e,o,i,a)}function O(t,e,n,r,o,i,a){return C(e&r|n&~r,t,e,o,i,a)}function P(t,e,n,r,o,i,a){return C(e^n^r,t,e,o,i,a)}function I(t,e,n,r,o,i,a){return C(n^(e|~r),t,e,o,i,a)}function _(t,e){var n,r,o,i,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var c=1732584193,s=-271733879,u=-1732584194,l=271733878;for(n=0;t.length>n;n+=16)r=c,o=s,i=u,a=l,c=A(c,s,u,l,t[n],7,-680876936),l=A(l,c,s,u,t[n+1],12,-389564586),u=A(u,l,c,s,t[n+2],17,606105819),s=A(s,u,l,c,t[n+3],22,-1044525330),c=A(c,s,u,l,t[n+4],7,-176418897),l=A(l,c,s,u,t[n+5],12,1200080426),u=A(u,l,c,s,t[n+6],17,-1473231341),s=A(s,u,l,c,t[n+7],22,-45705983),c=A(c,s,u,l,t[n+8],7,1770035416),l=A(l,c,s,u,t[n+9],12,-1958414417),u=A(u,l,c,s,t[n+10],17,-42063),s=A(s,u,l,c,t[n+11],22,-1990404162),c=A(c,s,u,l,t[n+12],7,1804603682),l=A(l,c,s,u,t[n+13],12,-40341101),u=A(u,l,c,s,t[n+14],17,-1502002290),c=O(c,s=A(s,u,l,c,t[n+15],22,1236535329),u,l,t[n+1],5,-165796510),l=O(l,c,s,u,t[n+6],9,-1069501632),u=O(u,l,c,s,t[n+11],14,643717713),s=O(s,u,l,c,t[n],20,-373897302),c=O(c,s,u,l,t[n+5],5,-701558691),l=O(l,c,s,u,t[n+10],9,38016083),u=O(u,l,c,s,t[n+15],14,-660478335),s=O(s,u,l,c,t[n+4],20,-405537848),c=O(c,s,u,l,t[n+9],5,568446438),l=O(l,c,s,u,t[n+14],9,-1019803690),u=O(u,l,c,s,t[n+3],14,-187363961),s=O(s,u,l,c,t[n+8],20,1163531501),c=O(c,s,u,l,t[n+13],5,-1444681467),l=O(l,c,s,u,t[n+2],9,-51403784),u=O(u,l,c,s,t[n+7],14,1735328473),c=P(c,s=O(s,u,l,c,t[n+12],20,-1926607734),u,l,t[n+5],4,-378558),l=P(l,c,s,u,t[n+8],11,-2022574463),u=P(u,l,c,s,t[n+11],16,1839030562),s=P(s,u,l,c,t[n+14],23,-35309556),c=P(c,s,u,l,t[n+1],4,-1530992060),l=P(l,c,s,u,t[n+4],11,1272893353),u=P(u,l,c,s,t[n+7],16,-155497632),s=P(s,u,l,c,t[n+10],23,-1094730640),c=P(c,s,u,l,t[n+13],4,681279174),l=P(l,c,s,u,t[n],11,-358537222),u=P(u,l,c,s,t[n+3],16,-722521979),s=P(s,u,l,c,t[n+6],23,76029189),c=P(c,s,u,l,t[n+9],4,-640364487),l=P(l,c,s,u,t[n+12],11,-421815835),u=P(u,l,c,s,t[n+15],16,530742520),c=I(c,s=P(s,u,l,c,t[n+2],23,-995338651),u,l,t[n],6,-198630844),l=I(l,c,s,u,t[n+7],10,1126891415),u=I(u,l,c,s,t[n+14],15,-1416354905),s=I(s,u,l,c,t[n+5],21,-57434055),c=I(c,s,u,l,t[n+12],6,1700485571),l=I(l,c,s,u,t[n+3],10,-1894986606),u=I(u,l,c,s,t[n+10],15,-1051523),s=I(s,u,l,c,t[n+1],21,-2054922799),c=I(c,s,u,l,t[n+8],6,1873313359),l=I(l,c,s,u,t[n+15],10,-30611744),u=I(u,l,c,s,t[n+6],15,-1560198380),s=I(s,u,l,c,t[n+13],21,1309151649),c=I(c,s,u,l,t[n+4],6,-145523070),l=I(l,c,s,u,t[n+11],10,-1120210379),u=I(u,l,c,s,t[n+2],15,718787259),s=I(s,u,l,c,t[n+9],21,-343485551),c=S(c,r),s=S(s,o),u=S(u,i),l=S(l,a);return[c,s,u,l]}function j(t){var e,n="",r=32*t.length;for(e=0;r>e;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function k(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;n.length>e;e+=1)n[e]=0;var r=8*t.length;for(e=0;r>e;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function L(t){var e,n,r="0123456789abcdef",o="";for(n=0;t.length>n;n+=1)e=t.charCodeAt(n),o+=r.charAt(e>>>4&15)+r.charAt(15&e);return o}function T(t){return unescape(encodeURIComponent(t))}function x(t){return function(t){return j(_(k(t),8*t.length))}(T(t))}function R(t,e){return function(t,e){var n,r,o=k(t),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=_(o,8*t.length)),n=0;16>n;n+=1)i[n]=909522486^o[n],a[n]=1549556828^o[n];return r=_(i.concat(k(e)),512+8*e.length),j(_(a.concat(r),640))}(T(t),T(e))}function B(t,e,n){return e?n?R(e,t):L(R(e,t)):n?x(t):L(x(t))}var M=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.env=e||E(),this.stackFilter=function(t){switch(t){case"iOS":return{filter:function(t){return 0>t.indexOf("[native code]")&&t.indexOf("@")>=0}};case"Android":return{filter:function(t,e){return e&&0>t.indexOf("nonymous")&&!0}};default:return{filter:function(){return!0}}}}(this.env).filter}var e,n,r;return e=t,(n=[{key:"makeReg",value:function(){return"iOS"===this.env?RegExp("(?:\\s*)\\w+(?=@)|(?:@).*?(?=:\\d*:)|(?::)\\d*(?=:)|(?::)\\d*$","g"):null}},{key:"stackFormatter",value:function(t){var e=t.message,n=[],r="Android"===this.env,o="iOS"===this.env,i=t.stack.split("\n").filter(this.stackFilter);i.shift();var a=i.join("\n"),c=this.makeReg();return c?i.map((function(t){var e=t.match(c);if(e){var i=y(e,4),a=i[0],s=void 0===a?"":a,u=i[1],l=void 0===u?"":u,f=i[2],d=void 0===f?"":f,p=i[3],h=void 0===p?"":p,v=r?s.split(".").reverse()[0]:s,g=o?1:0;n.push("at ".concat(v," (").concat(l.substr(g),":").concat(d.substr(g),":").concat(h.substr(g),")"))}else n.push(t);return null})):n=i,{hash:this.encryptStack(e,n),message:e,stackList:n,stackStr:a}}},{key:"encryptStack",value:function(t,e){var n=[].concat(m(e.slice(0,6)),m(e.slice(7,8)),m(e.slice(9,10)),m(e.slice(11,12)),m(e.slice(13,14))).join(";");return B("".concat(t,":").concat(n))}}])&&g(e.prototype,n),r&&g(e,r),t}(),F=/^\s*at .*? ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::\d+)?(?::\d+)?\)?\s*$/i,N=/^\s*.*?(?:\(.*?\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::\d+)?(?::\d+)?\s*$/i,D=/^\s*at (?:(?:\[object object\])?.+ )?\(?((?:file|ms-appx|https?|blob):.*?):\d+(?::\d+)?\)?\s*$/i;"undefined"==typeof process||v(process);var H=function(t){return function(t){for(var e=t.slice(0,20),n=["",""],r={},o=1,i=0;e.length>i;i+=1){var a=F,c=(e[i]||"").match(a);if(null===c&&(c=(e[i]||"").match(a=N)),null===c&&(c=(e[i]||"").match(a=D)),null!==c){var s=c[1],u=r[s];void 0===u&&(r[s]="#".concat(o,"#"),o+=1,u=r[s]),e[i]=e[i].replace(s,u)}}e.length>0&&(n[1]=e.map((function(t){return t.trim()})).join(""));var l="";for(var f in r)r.hasOwnProperty(f)&&(l+="".concat(f,"@").concat(r[f],";"));return l=l.replace(/;$/,""),n[0]=l,n.join("").replace(/\^/g,"").replace(/=/g,"").replace(/,/g,"")}(t)};function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function J(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){Y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function z(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,V(r.key),r)}}function Y(t,e,n){return(e=V(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G(t){return function(t){if(Array.isArray(t))return $(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function V(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e.length)return!0;for(var r=0;e.length>r;r++){var o=e[r];if(null==t[o])return n&&n("Field is required. Log cached."),!1}return!0}function K(t,e){if(!e||"object"!==U(e))return t;var n=t||{};for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(n[r]=e[r]);return n}function W(t,e){for(var n=e.split("."),r=0;n.length-1>r;r++)if("object"!==U(t=t[n[r]])||!t||Array.isArray(t))return"";return t[n.pop()]}function X(t,e,n){for(var r=e.split("."),o=0;r.length-1>o;o++){if("object"!==U(t[r[o]])&&void 0!==t[r[o]])return;if(Array.isArray(t[r[o]]))return;t[r[o]]||(t[r[o]]={}),t=t[r[o]]}t[r.pop()]=n}var Z=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaults={},this.configs={}}var e,n,r;return e=t,(n=[{key:"set",value:function(t,e,n){void 0!==n?(this.defaults[t]=n,this.configs[t]=e):(this.defaults[t]=e,delete this.configs[t])}},{key:"process",value:function(t){var e;for(var n in t=K({},t),this.defaults)if(this.defaults.hasOwnProperty(n))switch(this.configs[n]){case"call":X(t,n,this.defaults[n].call(this,W(t,n),t));break;case"make":void 0===W(t,n)&&X(t,n,this.defaults[n].call(this,t));break;case"append":var r=W(t,n);Array.isArray(r)||(r=[]),(e=r).push.apply(e,G(this.defaults[n])),X(t,n,r);break;default:void 0===W(t,n)&&X(t,n,this.defaults[n])}return t}}])&&z(e.prototype,n),r&&z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function tt(t,e){return t&&t.getAttribute&&t.getAttribute(e)||""}var et,nt={};function rt(t){console&&console.warn&&console.warn(t)}function ot(t,e){nt[t]||(nt[t]=1,rt("配置项 [".concat(t,"] 已不推荐使用。请使用 [").concat(e,"]。")))}function it(){var t,e;return et||(t=new Z,e=function(){var t={};for(var e in st)if(st.hasOwnProperty(e)){var n=ct(st[e]);n&&(t[e]=n)}return t}(),t.set("yuyanId","call",(function(t){return t||e.yuyanId})),t.set("bmAppid","call",(function(t,n){return n.yuyanId?(rt("已设置yuyanId，其他 id 将不生效"),null):t?(ot("bmAppid","_appId"),t):n.appid?(ot("appid","_appId"),n.appid):n._appId||e._appId})),t.set("userId","call",(function(t,e){return e.roleId?(ot("roleId","userId"),e.roleId):t})),t.set("disableInterface","call",(function(t){return t||!1})),t.set("oncePerSession","call",(function(t){return t||!1})),t.set("autoCapture","call",(function(t,e){return!e.hasOwnProperty("autoCapture")||!!e.autoCapture})),t.set("autoEnv","call",(function(t,e){return!e.hasOwnProperty("autoEnv")||!!e.autoEnv})),t.set("defaults","call",(function(t){return K({},t)})),t.set("sprintId","call",(function(t){return t||e.sprintId})),t.set("requiredFields","call",(function(t){return Array.isArray(t)?t:"string"==typeof t?[t]:[]})),t.set("eventId","call",(function(t,e){return"PC"===e.appType?"102022":"102023"})),t.set("beforeLog","call",(function(t){if("function"==typeof t)return t})),t.set("callBridge","call",(function(t){if("function"==typeof t)return t})),t.set("plugins","call",(function(t){return Array.isArray(t)?t:["tracert","performance","buc"]})),t.set("forceHttpReport","call",(function(t){return!!t})),et=t),et}var at,ct=(at=eval?(0,eval)("this"):global||window,function(t){var e;if(!(null==at||null===(e=at.document)||void 0===e?void 0:e.querySelectorAll))return"";for(var n=function(t){var e,n;try{return[].slice.call(t)}catch(o){e=[],n=t.length;for(var r=0;n>r;r++)e.push(t[r]);return e}}(at.document.querySelectorAll("meta")),r=0;n.length>r;r++){var o=n[r];if(tt(o,"name")===t)return tt(o,"content")}return null}),st={_appId:"bm_app_id",yuyanId:"yuyan_id",sprintId:"bm_sprint_id"};var ut={JS:1,REQUEST:2,PROMISEREJECTION:3,ASSETS:4},lt=Object.freeze({__proto__:null,ErrorCodeEnums:ut,CodeLevelEnums:{B:"禁用",L:"低",M:"中",H:"高"}}),ft=new M;var dt={};function pt(t,e){var n,r=e.beforeLog,o=e._warn,i=e.tenant;if(e.destroyed)o("destroyed");else{if("function"==typeof r)try{t=r(t)}catch(t){o("beforeLog 失败：",t)}if(!t||"object"!==U(t)&&Array.isArray(t))o("beforeLog返回值不是对象，不进行上报");else{var a=[t.code,t.msg||"",t.uid].join("_");if(!(null!==(n=t.oncePerSession)&&void 0!==n?n:e.oncePerSession)||!dt[a]){if((t.bmAppid||e.bmAppid)===e.bmAppid){if(t.code+""=="32767"+""||"MAIN_SITE"!==i)return t;var c=e.monitorOptionMap[Number(t.code)]||e.monitorOptionMap["".concat(t.code)];if(!e.monitorConfigFailed&&!c&&!function(t){return Number(t)>22e3&&23e3>Number(t)}(t.code))return void e._warn("监控平台没有该监控项的配置: ".concat(t.code));if(c){var s=c.sampleRate||t.sampleRate||1;if(Math.random()>Number(s))return void o("当前已设置采样率 ".concat(s,"，未被采集"));K(t,{sampleRate:s}),c.level&&K(t,{level:c.level});for(var u={},l=c.fields||[],f=0;l.length>f;f++)u[l[f]]=!0;for(var d in t)!u[d]&&/^[dmc]\d+$/.test(d)&&delete t[d]}}return dt[a]=1,t}e._warn("当前由于 OncePerSession 策略，未被采集")}}}var ht=function(t){return encodeURIComponent(t).replace(/'/g,"%27")};var vt;function gt(t){if(!t||"object"!==r(t))return[];var e,n,o=t.eventId,i=t.userId,a=t.ua,c=t.param4,s=t.resolution,u=["D-AE",(e=new Date,n=function(t){return 10>t?"0".concat(t):"".concat(t)},"".concat(e.getFullYear(),"-").concat(n(e.getMonth()+1),"-").concat(n(e.getDate())," ").concat(n(e.getHours()),":").concat(n(e.getMinutes()),":").concat(n(e.getSeconds()),":").concat(e.getMilliseconds())),"","","2","","",i,"1000",o,"H5behavior","2","","","","","","","","","","","","","",s,"","","",a,"","","","","",""];return u.push(function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^",r=[];if(t instanceof Array)r=t;else if(t instanceof Object){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?ht:function(t){return t};for(e in t)if(t.hasOwnProperty(e)){var i=o(t[e]);r.push("".concat(e,"=").concat(i))}}return r.join(n)}(c,"^",!0)),u}function yt(t,e,n){var r=e||window.document;r.addEventListener?r.addEventListener(t,n,!0):r.attachEvent?r.attachEvent("on".concat(t),n):r[t]=n}function mt(t,e,n){var r=e||window.document;r.removeEventListener?r.removeEventListener(t,n,!0):r.detachEvent?r.detachEvent("on".concat(t),n):r[t]=n}!function(t){t.stable="STABLE",t.test="TEST",t.pre="PRE",t.prod="PROD",t.sandbox="SANDBOX",t.unknown="UNKNOWN"}(vt||(vt={}));var bt=function(){var t="undefined"!=typeof my;if(t){var e,n,r=t?null===(e=my)||void 0===e||null===(n=e.env)||void 0===n?void 0:n.clientEnv:void 0;switch(r){case"stable":case"test":case"pre":case"prod":return vt[r];case"gray":return vt.prod;default:return vt.unknown}}else if("undefined"!=typeof navigator&&navigator.userAgent&&"undefined"!=typeof window){var o,i;if(void 0!==window.AlipayJSBridge&&"undefined"!==window.AlipayJSBridge.startupParams){var a,c=window.AlipayJSBridge.startupParams.gateway_env;if("string"==typeof c)return null!==(a=vt[c])&&void 0!==a?a:vt.unknown}if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&-1===navigator.userAgent.indexOf("ProductType/dev"))return vt.prod;if(navigator.userAgent.indexOf("Android")>0&&void 0!==window.AlipayJSBridge&&void 0!==window.AlipayJSBridge.startupParams&&!(null===(o=window.AlipayJSBridge)||void 0===o||null===(i=o.startupParams)||void 0===i?void 0:i.isSpecialEdition))return vt.prod}return vt.unknown},wt=function(){var t=i(n().mark((function t(){var e;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=bt())===vt.unknown){t.next=3;break}return t.abrupt("return",e);case 3:if("undefined"==typeof navigator||!navigator.userAgent||"undefined"==typeof window){t.next=6;break}if(void 0===window.AlipayJSBridge){t.next=6;break}return t.abrupt("return",new Promise((function(t){window.AlipayJSBridge.call("getConfig",{configKeys:["rpcUrl"]},(function(e){var n,r=(null==e||null===(n=e.data)||void 0===n?void 0:n.rpcUrl)||"";return r.indexOf("stable.alipay.net")>0?t(vt.stable):r.indexOf("test.alipay.net")>0?t(vt.test):r.indexOf("mobilegwpre.alipay.com")>0?t(vt.pre):r.indexOf("mobilegw.alipaydev.com")>0?t(vt.sandbox):r.indexOf("mobilegw.alipay.com")>0?t(vt.prod):t(vt.unknown)}))})));case 6:return t.abrupt("return",vt.unknown);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Et=function(t){var e={name:"web",client:null};return"object"===("undefined"==typeof dd?"undefined":r(dd))&&dd&&"function"==typeof dd.httpRequest?(e.client=dd,e.name="dd"):"object"===("undefined"==typeof my?"undefined":r(my))&&my&&"function"==typeof my.request?(e.client=my,e.name="my"):"object"===("undefined"==typeof wx?"undefined":r(wx))&&wx&&"function"==typeof wx.request&&(e.client=wx,e.name="wx"),e[t]};function St(t,e){return t&&t.getAttribute&&t.getAttribute(e)||""}function Ct(t,e){var n=t.id?"".concat(t.id):"",r=t.className?"".concat(t.className):"",o=t.tagName.toLowerCase(),i=n||r,a=[];n&&a.push('[@id="'.concat(n,'"]')),r&&a.push('[@class="'.concat(r,'"]'));var c="".concat(o).concat(i?a.join(""):"");return t.parentNode&&t.parentNode.tagName&&e-1!=0?"".concat(Ct(t.parentNode,e-1),">").concat(c):c}var At="data-aspm";var Ot,Pt={main_site:"https://collect.alipay.com/yuyan/",mybank:"https://collect.mybank.cn/yuyan/"},It={main_site:"collect.alipay.com",mybank:"collect.mybank.cn"};!function(t){t.WX="wx",t.MY="my",t.DD="dd"}(Ot||(Ot={}));var _t=["connectEnd","connectStart","decodedBodySize","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domainLookupEnd","domainLookupStart","duration","encodedBodySize","fetchStart","loadEventEnd","loadEventStart","redirectCount","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","transferSize","type","unloadEventEnd","unloadEventStart","workerStart","firstPaint","firstContentfulPaint","LargestContentfulPaint","FirstInputDelay"];function jt(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];if(console&&console.warn){var o=t.split("%s").map((function(t,e){return t&&"[YuyanMonitor]".concat(t).concat(n[e])})).join("");console.warn(o)}}var kt=lt.ErrorCodeEnums,Lt=(new Date).getTime(),Tt=function(){function t(n){var o,i,c=this;a(this,t),this.eventId=void 0,this.bmAppid=void 0,this.debug=void 0,this.tenant=void 0,this.beforeLog=void 0,this.clientApp=void 0,this.clientName=void 0,this.aggregationPeriod=void 0,this.resolution=void 0,this.userConfig={},this.oncePerSession=void 0,this.defaults={},this.cOfflineVer="",this.cAppId="",this.cUserId="",this.autoEnv=void 0,this.autoCapture=void 0,this.disableInterface=void 0,this.trackedLogs=[],this.requiredFields=[],this.isErrorHandler=!1,this.enabledPlugins=[],this.forceHttpReport=!1,this.fullURL="",this.title="",this.env="",this.monitorConfigInited=!1,this.monitorConfigFailed=!1,this.monitorOptions=[],this.getErrorEventHandler=function(t){c.handleErrorEvent(t,(function(t){c.log(t,{reportDirectly:!0})}))},this._warn=function(){var t=window;if("object"===r(t)&&t.console&&"function"==typeof t.console.warn&&c.debug){for(var e=arguments.length,n=Array(e),o=0;e>o;o++)n[o]=arguments[o];var i=Array.prototype.slice.call(n);t.console.warn.call(null,"[Monitor Debug]".concat(i[0]),i.slice(1))}},this.pcSend=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L",n=arguments.length>2?arguments[2]:void 0,r=n&&"number"==typeof n?t.join("$$"):encodeURIComponent(t.join());(c.debug||c.userConfig.debug)&&console.log("[YuyanMonitor]SEND: %s",r);var o="undefined"!=typeof navigator&&navigator;if(o&&o.sendBeacon&&"function"==typeof o.sendBeacon){var i={type:"application/x-www-form-urlencoded",Host:"".concat(It[c.tenant.toLowerCase()])},a=new Blob(["data=".concat(r,"&time=").concat((new Date).getTime())],i);if(o.sendBeacon("".concat(Pt[c.tenant.toLowerCase()],"?biztype=yuyanmonitor").concat(e.toLowerCase()),a))return}return fetch("".concat(Pt[c.tenant.toLowerCase()],"?biztype=yuyanmonitor").concat(e.toLowerCase()),{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Host:"".concat(It[c.tenant.toLowerCase()])},body:"data=".concat(r,"&time=").concat((new Date).getTime())}).catch((function(){try{(new Image).src="".concat(Pt[c.tenant.toLowerCase()],"?data=").concat(r,"&time=").concat((new Date).getTime())}catch(t){jt("通过 IMG 上报失败: %s",t)}}))},this.clientHttpSend=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L",r={"Content-type":"application/x-www-form-urlencoded",Host:"".concat(It[c.tenant.toLowerCase()])},o={url:"".concat(Pt[c.tenant.toLowerCase()],"?biztype=yuyanmonitor").concat(n.toLowerCase()),method:"POST",data:"data=".concat(t,"&time=").concat((new Date).getTime()),fail:function(e){try{(new Image).src="".concat(Pt[c.tenant.toLowerCase()],"?data=").concat(t,"&time=").concat((new Date).getTime())}catch(t){jt("通过 IMG 上报失败: %s",t)}c.debug&&jt("请求发送失败",e)}};c.clientApp&&c.clientApp.canIUse("request")?c.clientApp.request(e(e({},o),{},c.clientName===Ot.WX?{header:r}:{headers:r})):c.clientApp&&c.clientApp.canIUse("httpRequest")?c.clientName===Ot.DD&&c.clientApp.httpRequest(e(e({},o),{},{headers:r})):jt("调用API失败，无法完成上报")};var s=it().process(n);this.userConfig=s,this.eventId=s.eventId||"102022",this.bmAppid=s.bmAppid,this.tenant=s.tenant||"MAIN_SITE",this.resolution=s.resolution||"",this.aggregationPeriod=s.aggregationPeriod,this.debug=s.debug||!1,this.clientApp=Et("client"),this.clientName=Et("name")||"web",this.autoCapture=s.autoCapture,this.autoEnv=s.autoEnv||!0,this.disableInterface=s.disableInterface,this.oncePerSession=s.oncePerSession,this.beforeLog=s.beforeLog,this.defaults=s.defaults||{},this.requiredFields=s.requiredFields||[],this.enabledPlugins=s.plugins,this.forceHttpReport=!!s.forceHttpReport,this.fullURL=(null===(o=s.defaults)||void 0===o?void 0:o.url)||s.url||"",this.title=(null===(i=s.defaults)||void 0===i?void 0:i.title)||s.title||""}return s(t,[{key:"handleErrorEvent",value:function(t,e){try{var n=t.target||t.srcElement;if(!n)return;if("unhandledrejection"===t.type){var r=t.reason||{};if(r.message&&r.stack)this.logError(r,{code:kt.PROMISEREJECTION});else{var o=r.message||("string"==typeof r?r:JSON.stringify(r));e({code:kt.PROMISEREJECTION,msg:o})}return}if(n instanceof HTMLElement){var i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.src||t.href;return"img"===t.tagName.toLowerCase()&&0===e.indexOf("data:")&&(e=e.split(",")[0]),e}(n),a=n.tagName.toLowerCase(),c=n.alt,s=void 0===c?"":c;return void e({code:kt.ASSETS,msg:i===("undefined"!=typeof location&&location&&location.href)?"__EMPTY__SRC__":i||"",s1:a,s2:Ct(n,5),s3:s})}if(t.error&&t.error.stack)return void this.logError(t.error);e({code:kt.JS,msg:t.message,s3:0})}catch(t){jt("handleErrorOptions failed: %s",t.message)}}},{key:"handlePreCapture",value:function(){var t=this,e=window.g_monitor;if(e){var n=e.listener,r=void 0===n?{}:n,o=e.events,i=void 0===o?[]:o;for(var a in r)r.hasOwnProperty(a)&&(mt(a,window,r[a]),delete r[a]);for(var c=0;i.length>c;c++)this.handleErrorEvent(i[c],(function(e){t.log(e)}));e.events=[]}}},{key:"register",value:function(){var t=document;if(this.autoCapture)try{if(!t)return jt("当前为非 web 环境，不支持报错监听与插件使用"),this;if(this.isErrorHandler)return void jt("错误事件已监听");yt("error",window,this.getErrorEventHandler),yt("unhandledrejection",window,this.getErrorEventHandler),this.isErrorHandler=!0}catch(t){jt("异常监听事件注册失败: %s",t.message)}else jt("已通过 autoCapture 禁用异常捕获")}},{key:"unregister",value:function(){mt("error",window,this.getErrorEventHandler),mt("unhandledrejection",window,this.getErrorEventHandler),this.isErrorHandler=!1}},{key:"getNetwork",value:function(){var t=navigator;return t&&t.connection&&t.connection.effectiveType?t.connection.effectiveType:""}},{key:"parseParam4",value:function(t){if(!t||"object"!==r(t))return null;var n=e(e({},this.defaults),t);(t.bmAppid||this.bmAppid)&&(n.bm_appid=t.bmAppid||this.bmAppid),this.userConfig.sprintId&&(n.bm_sid=this.userConfig.sprintId),this.userConfig.yuyanId&&(n.yuyan_id=this.userConfig.yuyanId),this.userConfig.cClientVer&&(n.c_client_ver=this.userConfig.cClientVer),this.userConfig.os&&(n.os=this.userConfig.os),this.userConfig.deviceModel&&(n.device_model=this.userConfig.deviceModel),this.userConfig.deviceBrand&&(n.device_brand=this.userConfig.deviceBrand),this.userConfig.deviceType&&(n.device_type=this.userConfig.deviceType),n.env=this.userConfig.env||this.env;var o="undefined"!=typeof location&&location?location.href:"";if(n.title=this.title||this.userConfig.title||"",n.fullURL=n.fullURL||this.fullURL||o||this.userConfig.fullURL||"",n.monitor_ver="sdk:1.1.0",!this.clientApp&&"undefined"!=typeof document){var i,a;if("undefined"!=typeof window)this.resolution="".concat(null===(i=window.screen)||void 0===i?void 0:i.width,"x").concat(null===(a=window.screen)||void 0===a?void 0:a.height);var c=document.documentElement;n.title=document.title||this.title,n.dom_cnt=document.getElementsByTagName("*").length,n.delay=(new Date).getTime()-Lt,n.scroll_top=c.scrollTop+document.body.scrollTop,n.content_height=Math.max(c.clientHeight,c.offsetHeight,c.scrollHeight),n.s_c=!this.monitorConfigFailed}n.network=this.getNetwork()||this.userConfig.network||"";var s=this.userConfig.spmAPos&&this.userConfig.spmBPos?"".concat(this.userConfig.spmAPos,".").concat(this.userConfig.spmBPos):"";if(s&&(n.spmId=s),this.cOfflineVer&&(n.c_offline_ver=this.cOfflineVer),this.cAppId&&(n.c_app_id=this.cAppId),"object"===r(n)){var u=n;for(var l in u)u.hasOwnProperty(l)&&"string"==typeof u[l]&&u[l].replace(/\s+/g," ")}return n}},{key:"bridgeCall",value:function(){if(this.clientApp&&this.clientName===Ot.MY&&"function"==typeof my.call){var t;(t=my).call.apply(t,arguments)}else{var e,n=window;if(!n.AlipayJSBridge||!n.AlipayJSBridge.call||"function"!=typeof n.AlipayJSBridge.call)return void jt("非容器环境，不能调用 handleLoggingAction");(e=n.AlipayJSBridge).call.apply(e,arguments)}}},{key:"bridgeLog",value:function(t){var e=t||{};this.bridgeCall("handleLoggingAction",{actionType:"reportEvent",params:{eventId:this.eventId,bizType:"yuyanmonitor".concat((arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L").toLowerCase()),extData:e}})}}]),t}();var xt="_YUYAN_COOKIE_monitor_config_next",Rt=function(){function t(){a(this,t)}return s(t,[{key:"getStorageInfoMap",value:function(){var t=function(t){try{var e,n;return null===(e=window)||void 0===e||null===(n=e.localStorage)||void 0===n?void 0:n.getItem(t)}catch(t){return jt("从 localStorage 中获取配置失败"),null}}(xt)||"{}";try{return JSON.parse(t)}catch(t){return{}}}},{key:"getMonitorConfig",value:function(t){var e=this.getStorageInfoMap()[t];return!e||(new Date).valueOf()>e.expire?null:e.config}},{key:"saveMonitorConfig",value:function(t,e){var n=this.getStorageInfoMap();n[t]={config:e,expire:(new Date).valueOf()+9e5},function(t,e){try{var n,r;return null===(n=window)||void 0===n||null===(r=n.localStorage)||void 0===r?void 0:r.setItem(t,e)}catch(t){return jt("写入 localStorage 失败"),null}}(xt,JSON.stringify(n))}}]),t}(),Bt=function(){function t(){a(this,t),this.monitor=void 0,this.configStorage=new Rt}return s(t,[{key:"apply",value:function(t){this.monitor=t;var e=t.bmAppid||t.userConfig.yuyanId;this.enhance(t,e);try{this.fetchMonitorConfig(e)}catch(t){this.monitor.onFetchConfigError(t)}}},{key:"enhance",value:function(t,e){var n=this;K(t,{initMonitorConfigs:function(r){t.setMonitorConfigs(r),n.configStorage.saveMonitorConfig(e,r)},setMonitorConfigs:function(e){t.monitorOptions=e.monitors,t.monitorConfigInited=!0,t.onMonitorConfigInited()}})}},{key:"fetchMonitorConfig",value:function(t){var e=this.monitor,n=e.setMonitorConfigs;if("MAIN_SITE"===e.tenant){var r=this.configStorage.getMonitorConfig(t);if(r)return n(r);this.fetchRemoteConfigJson(t)}}},{key:"fetchRemoteConfigJson",value:function(t){var e=this;fetch("https://render.alipay.com/p/alertserver/".concat(t,"_config/index.json"),{redirect:"follow"}).then((function(t){return t.json()})).then((function(t){e.monitor.initMonitorConfigs(t)})).catch((function(t){e.monitor.onFetchConfigError(t)}))}}]),t}(),Mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Ft=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}((function(t){var e,n;e="undefined"!=typeof self?self:Mt,n=function(){if("object"==typeof window){var t,e=window,n={0:"navigate",1:"reload",2:"back_forward"},r=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart"];return e&&e.performance&&"object"==typeof e.performance&&e.performance.timing?"function"==typeof e.performance.getEntries&&"function"==typeof e.performance.getEntriesByType&&"function"==typeof e.performance.getEntriesByName&&"function"==typeof e.performance.now&&e.performance.timeOrigin?e.performance:t={_entry:function(){for(var t=e.performance.timing,o=t.navigationStart||t.redirectStart||t.fetchStart,i={entryType:"navigation",initiatorType:"navigation",name:e.location.href,startTime:0,duration:t.loadEventEnd?t.loadEventEnd-o:0,redirectCount:e.performance.navigation.redirectCount,type:n[e.performance.navigation.type]},a=0;r.length>a;a++){var c=r[a],s=t[c];i[c]=s?s-o:0}return i}(),timeOrigin:e.performance.timing.navigationStart,getEntries:function(){return[this._entry]},getEntriesByType:function(t){return"navigation"!==t?[]:[this._entry]},getEntriesByName:function(t){return t!==e.location.href?[]:[this._entry]},now:function(){return Date.now()-e.performance.timing.navigationStart}}:t}},t.exports?t.exports=n():e.timing2=n()})),Nt=function(t){if("object"!==r(t))return[];var e=t.getEntriesByType("paint"),n={};if(e.length){var o=(e.filter((function(t){return"first-paint"===t.name}))[0]||{}).startTime,i=(e.filter((function(t){return"first-contentful-paint"===t.name}))[0]||{}).startTime;n.firstPaint=parseFloat(o),n.firstContentfulPaint=parseFloat(i)}return n};function Dt(t,e){return t?function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=isNaN(t[n])?0:Math.round(Math.min(Math.max(0,parseFloat(t[n])),3e5)));return e}({m1:e.duration||parseFloat(t.loadEventEnd)-e.startTime,m2:parseFloat(t.domContentLoadedEventStart)-e.startTime,m3:parseFloat(t.domComplete)-e.startTime,m4:t.firstPaint,m5:t.firstContentfulPaint,m6:t.LargestContentfulPaint,m7:parseFloat(t.redirectEnd)-parseFloat(t.redirectStart),m8:parseFloat(t.domainLookupStart)-parseFloat(t.fetchStart),m9:parseFloat(t.domainLookupEnd)-parseFloat(t.domainLookupStart),m10:parseFloat(t.connectEnd)-parseFloat(t.connectStart),m11:parseFloat(t.connectEnd)-parseFloat(t.secureConnectionStart),m12:parseFloat(t.responseStart)-parseFloat(t.requestStart),m13:parseFloat(t.responseEnd)-parseFloat(t.responseStart),m14:parseFloat(t.domComplete)-parseFloat(t.responseEnd),m15:parseFloat(t.loadEventEnd)-parseFloat(t.responseEnd),m16:parseFloat(t.domInteractive)-e.startTime,m17:parseFloat(t.domContentLoadedEventEnd)-parseFloat(t.domContentLoadedEventStart),m18:t.FirstInputDelay}):{}}var Ht=0,qt=0;function Jt(t,n){if("object"===r(n)&&!t.metricsSent)try{var o,i,a=n.getEntriesByType("navigation")[0],c=function(t,n,o){if("object"!==r(t)||"function"!=typeof t.getEntriesByType)return null;var i=null==t?void 0:t.getEntriesByType("navigation");if(!i||0===i.length)return null;var a=i[0],c=Nt(t),s={LargestContentfulPaint:n},l={FirstInputDelay:o};return _t.reduce((function(t,n){var r=a[n]||c[n]||s[n]||l[n];return e(e({},t),{},u({},"".concat(n),null==r||"number"==typeof r&&isNaN(r)?0:r))}),{})}(n,Ht,qt),s={d1:(null===(o=navigator)||void 0===o||null===(i=o.connection)||void 0===i?void 0:i.effectiveType)||"-",d2:0===a.duration?1:0,d3:document.hidden?0:1},l={c1:document.title};t.log(e(e(e({code:"32767",msg:"undefined"!=typeof location?location.href:""},Dt(c,a)),s),l)),t.metricsSent=!0}catch(t){}}var Ut=function(){function t(){a(this,t),this.monitor=void 0}return s(t,[{key:"apply",value:function(t){this.monitor=t;try{var e=new PerformanceObserver((function(t){var e=t.getEntries(),n=e[e.length-1],r=t.getEntries()[0];qt=r.processingStart-r.startTime,Ht=n.startTime}));e.observe({type:"largest-contentful-paint",buffered:!0}),e.observe({type:"first-input",buffered:!0})}catch(t){}if("object"===r(Ft))try{var n,o;"function"==typeof Ft.setResourceTimingBufferSize&&Ft.setResourceTimingBufferSize(500);var i=!!((null===(n=navigator)||void 0===n?void 0:n.swuserAgent)||(null===(o=navigator)||void 0===o?void 0:o.userAgent)||"").match(/iPhone|iPad|iPod/i);window.addEventListener(i?"pagehide":"beforeunload",Jt.bind(null,t,Ft))}catch(t){}}}]),t}(),zt=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"l",o=arguments.length>2?arguments[2]:void 0;a(this,t),this.cache=[],this.cacheSize=0,this.bizType=void 0,this.aggregationPeriod=void 0,this.timer=void 0,this._send=void 0,this.send=function(){n.cache.length&&(n._send(n.cache,n.bizType,n.aggregationPeriod),n.cache.length=0,n.cacheSize=0,n.resetTimer())},this._send=e,this.bizType=r,o&&(this.aggregationPeriod=1e3*o)}return s(t,[{key:"add",value:function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return this._send(t);this.addToCache(t)}},{key:"sendImmediately",value:function(){this.send()}},{key:"addToCache",value:function(t){var e=encodeURIComponent(t.join(",")),n=function(t){return t.split(/%..|./).length-1}(e);this.cacheSize+n>1048476&&this.send(),this.cache.push(e),this.cacheSize+=n,this.resetTimer()}},{key:"resetTimer",value:function(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.send,this.aggregationPeriod)}}]),t}(),Yt={};function Gt(t,e){if(Yt[t])return e(null,!0);fetch("https://dataservice.alipayobjects.com/alertserver/hash/".concat(t)).then((function(n){return 200===n.status||304===n.status?(Yt[t]=!0,e(null,!0)):e(null,!1)})).catch((function(t){return e(t,!1)}))}function $t(t){return Promise.resolve(!1)}var Vt=lt.ErrorCodeEnums,Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(c,t);var e,o=p(c);function c(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{appType:"H5"};return a(this,c),(t=o.call(this,e)).isAlipay=void 0,t.jsBridgeReady=!1,t.commandCache=[],t.requestQueue={l:new zt(t.pcSend,"l",t.aggregationPeriod),m:new zt(t.pcSend,"m",t.aggregationPeriod),h:new zt(t.pcSend,"h",t.aggregationPeriod)},t.monitorOptionMap={},t.UserConfig={},t.destroyed=!1,t.clientApp=Et("client"),t.clientName=Et("name")||"web",t.pageChangeEventHandler=function(){"undefined"!=typeof document&&"hidden"===document.visibilityState&&t.requestQueue.l.sendImmediately()},t.isAlipay=!("undefined"==typeof window||!window)&&function(t){var e=t&&t.userAgent;if(!e)return!1;var n=function(t){var e={is:!1,name:"",version:""},n=t.match(/AliApp\S+\b\)/gi);e.is=/(T-UA)|(TBIOS)|(WindVane)|(AliApp)/i.test(t);try{e.name=n?n[0].match(/\(\w+\-*\w*/)[0].split("(")[1]:"",e.version=n?n[0].match(/(\d+\.*)+/gi)[0]:""}catch(t){}return e}(e);return["AP","AF","AFW","BK","AM","APHK","KB"].indexOf(n.name)>=0}(window.navigator),t.initJsBridge(),t.clientApp||"undefined"==typeof document||"undefined"==typeof window||((new Bt).apply(d(t)),-1!==t.enabledPlugins.indexOf("performance")&&(new Ut).apply(d(t)),t.fetchConfig(),t.handlePreCapture(),t.register(),t.pageChangeEvent()),t}return s(c,[{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(t){if(!(null==e?void 0:e.forceHttpReport)&&(this.isAlipay&&!this.jsBridgeReady||"MAIN_SITE"===this.tenant&&!this.monitorConfigInited&&!this.clientApp))return this.commandCache.push([t,e]),void jt("主站租户且监控配置初始化未完成，上报信息进入缓存",this.commandCache);if(!Q(this.userConfig,this.requiredFields,this._warn.bind(this)))return this.commandCache.push([t,e]),void jt("必要项未准备好，上报进入缓存",this.commandCache);if(!(null==e?void 0:e.forceHttpReport)&&!this.jsBridgeReady&&!this.monitorConfigInited&&this.clientApp&&this.clientName===Ot.MY)return this.commandCache.push([t,e]),void jt("小程序初始化参数未获取，上报信息进入缓存",this.commandCache);var n=t.sampleRate,r=void 0===n?1:n;1!==r&&Math.random()>r?this.debug&&jt("未被采集，已设置采样率: ",r):this._log(t,e)}}},{key:"logError",value:function(t,e){!function(t,e,n){var r=n.log,o=n._warn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var a=(null==i?void 0:i.code)||ut.JS,c="";if(t)if(t.stack){var s=ft.stackFormatter(t),u=s.hash,l=s.stackList;c=u,u&&l&&l.length&&e(u,(function(t,e){if(t)return o("hash检测失败",t);e||r(J(J({},i),{},{code:ut.JS,s1:u,s2:H(l),s3:1}))})),r(J({code:a,msg:t.message,s10:c},i))}else r(J({code:a,msg:t.message||t},i))}catch(t){o("异常上报失败:",t)}}(t,this.clientApp?$t:Gt,{log:this.log.bind(this),_warn:this._warn.bind(this)},e)}},{key:"logRequestError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!t||this.clientApp)return;var e=t.type,n=void 0===e?"http":e;if("http"===n){var r=t.status,o=t.url,i=t.query,a=t.data,c=t.response,s=t.traceId,u={code:t.code||2,msg:"".concat(t.method.toUpperCase()," ").concat(o)};r&&(u.s1=r),i&&(u.s2=i),a&&(u.s3=a),c&&(u.s4=c),s&&(u.s5=s),this.log(u)}}catch(t){jt("接口异常上报失败:%s",t)}}},{key:"config",value:function(t){t&&"object"===r(t)&&(!function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}(this.userConfig,t),t.beforeLog&&(this.beforeLog=t.beforeLog),t.tenant&&(this.tenant=t.tenant),Q(this.userConfig,this.requiredFields,this._warn.bind(this))&&this.logCache())}},{key:"pageChangeEvent",value:function(){this.aggregationPeriod&&"number"==typeof this.aggregationPeriod&&yt("visibilitychange",document,this.pageChangeEventHandler)}},{key:"destroy",value:function(){this.unregister(),this.aggregationPeriod&&"number"==typeof this.aggregationPeriod&&mt("visibilitychange",document,this.pageChangeEventHandler),this.destroyed=!0}},{key:"isBridgeReport",value:function(){return this.clientApp?!(!this.clientApp||this.clientName!==Ot.MY):"undefined"!=typeof window&&!!window.AlipayJSBridge}},{key:"logCache",value:function(){for(var t=this.commandCache,e=0;t.length>e;e++){var n=t[e];Array.isArray(n)&&this._log(n[0],n[1])}this.commandCache=[]}},{key:"_log",value:function(t,e){var n,r,o,i=this.clientApp?t:pt(t,this);if(i){var a=this.parseParam4(i);this.clientApp||this.getExtraInfo();var c=this.userConfig.forceHttpReport||!!(null==e?void 0:e.forceHttpReport),s=null!==(n=(null===(r=navigator)||void 0===r?void 0:r.swuserAgent)||(null===(o=navigator)||void 0===o?void 0:o.userAgent))&&void 0!==n?n:"",u=s?s.replace(/,/g,"%2C"):"";if(c||!this.isBridgeReport()){var l=i.roleId||this.userConfig.userId||this.cUserId||"",f=i.resolution||this.resolution||"";delete i.roleId;var d=gt({eventId:this.eventId,userId:l,param4:a,ua:u,resolution:f});if(!d.length)return;if(this.clientApp){for(var p=0,h=Object.keys(d);h.length>p;p++){var v=h[p];d[v]=ht(d[v])}return void this.clientHttpSend(d)}return this.aggregationPeriod&&"number"==typeof this.aggregationPeriod?(this.requestQueue[i.level]||this.requestQueue.l).add(d,null==e?void 0:e.reportDirectly):this.pcSend(d,"l",this.aggregationPeriod)}a._ua=u;for(var g=0,y=Object.keys(a);y.length>g;g++){var m=y[g];a[m]=ht(a[m])}this.bridgeLog(a,i.level)}}},{key:"getExtraInfo",value:function(){var t=window._to||{};if(!this.userConfig.spmAPos){var e=function(t){for(var e,n,r,o,i=function(t){var e,n;try{return[].slice.call(t)}catch(o){e=[],n=t.length;for(var r=0;n>r;r++)e.push(t[r]);return e}}(t||document.getElementsByTagName("meta")),a=i.length,c=0;a>c;c++)if(n=St(e=i[c],"name"),r=St(e,"content"),n===At&&r){o=r;break}var s={};return o&&(s.spmAPos=o),s}().spmAPos||t.spmAPos;e&&(this.userConfig.spmAPos=e)}if(!this.userConfig.spmBPos){var n=St(document.body,At)||t.spmBPos;n&&(this.userConfig.spmBPos=n)}}},{key:"initJsBridge",value:function(){var t=this;if(this.clientApp&&this.clientName===Ot.MY){var e=function(){t.jsBridgeReady||(t.jsBridgeReady=!0,t.logCache())};this.getInfoFromBridge(e),setTimeout(e,3e3)}else this.clientApp||"undefined"==typeof document||"undefined"==typeof window?this.jsBridgeReady=!0:document.addEventListener("AlipayJSBridgeReady",(function(){t.onJsBridgeReady()}))}},{key:"getInfoFromBridge",value:(e=i(n().mark((function t(e){var r=this;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.autoEnv&&!this.userConfig.autoEnv){t.next=5;break}return t.next=4,wt();case 4:this.env=t.sent;case 5:this.bridgeCall("getStartupParams",(function(t){r.cOfflineVer=t.version||t.appVersion||"",(t.version||t.appVersion)&&(r.cAppId=t.appId),r.fullURL=r.fullURL||t.url||"",r.title=r.title||t.defaultTitle||"",e()})),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),e(),jt("调用容器接口获取信息失败:%s",t.t0.message);case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t){return e.apply(this,arguments)})},{key:"onJsBridgeReady",value:function(){var t=this;this.getInfoFromBridge((function(){t.jsBridgeReady=!0,t.monitorConfigInited&&t.logCache()}))}},{key:"set",value:function(){!function(t,e){var n=t||{};if(!e||"object"!==r(e))return n;for(var o in e)e.hasOwnProperty(o)&&void 0!==e[o]&&(n[o]=e[o])}(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"setMonitorConfigs",value:function(){}},{key:"initMonitorConfigs",value:function(t){}},{key:"fetchConfig",value:function(){}},{key:"fetchConfigByRequest",value:function(){}},{key:"fetchConfigByJSBridge",value:function(){}},{key:"onMonitorConfigInited",value:function(){var t=this;this.monitorOptions&&this.monitorOptions.forEach((function(e){e&&e.code&&(t.monitorOptionMap[e.code]=e)}));var e=this.monitorOptionMap[Vt.REQUEST];!this.disableInterface&&e&&(e.code===Vt.REQUEST&&e.isActive&&!e.isDeleted&&function(t){var e=!1;if("undefined"!=typeof window&&"XMLHttpRequest"in window){var n=window.XMLHttpRequest.prototype,r=n.open;n.open=function(t,e){this.__interfaceMonitor__={method:t,url:e||"",status_code:null};for(var n=Array(arguments.length),o=0;n.length>o;++o)n[o]=arguments[o];r.apply(this,n)};var o=n.send;n.send=function(n){var r=this;function i(){if(r.__interfaceMonitor__&&4===r.readyState)try{var o=r.__interfaceMonitor__.url;if(0===r.status)return;var i=o.split("?")[0],a=o.split("?")[1]||"",c="string"==typeof n?n:JSON.stringify(n),s=r.response+"";if(s.length>2048&&(s="[too large]"),200>r.status||r.status>299||e){if(i===t.server)return void t._warn("上报异常",c);t.logRequestError({type:"http",status:r.status,url:i,method:r.__interfaceMonitor__.method,query:a,data:c,response:s,traceId:t.traceId||""})}}catch(e){t._warn("接口异常上报失败:",e)}}if("onreadystatechange"in r&&"function"==typeof r.onreadystatechange){var a=r.onreadystatechange;r.onreadystatechange=function(){for(var t=Array(arguments.length),e=0;t.length>e;++e)t[e]=arguments[e];i.apply(this,t),a.apply(this,t)}}else r.onreadystatechange=i;for(var c=Array(arguments.length),s=0;c.length>s;++s)c[s]=arguments[s];return o.apply(this,arguments)}}if("undefined"!=typeof window&&"fetch"in window){var i=window.fetch;window.fetch=function(){for(var n=Array(arguments.length),r=0;n.length>r;++r)n[r]=arguments[r];var o="GET";return n[1]&&n[1].method&&(o=n[1].method.toUpperCase()),i.apply(this,n).then((function(r){return new Promise((function(i){try{var a=n[0],c=a.split("?")[0],s=a.split("?")[1]||"",u=n[1]&&n[1].body||"",l="string"==typeof u?u:JSON.stringify(u);r.clone().text().then((function(n){r.ok&&!e||t.logRequestError({type:"http",status:r.status,url:c,method:o,query:s,data:l,response:(n||"").length>2048?"[too large]":n,traceId:t.traceId||""})})).then((function(){i(r)}),(function(){i(r)}))}catch(t){i(r)}}))}))}}}(this));this.isAlipay&&!this.jsBridgeReady||this.logCache()}},{key:"onFetchConfigError",value:function(t){this.monitorConfigInited=!0,this.monitorConfigFailed=!0,this.onMonitorConfigInited(),jt("获取服务端配置失败：%s",t.message)}}]),c}(Tt);return Qt}));
